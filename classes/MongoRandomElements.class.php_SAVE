<?php/** *  MongoRandomElements.class.php *  File with the class used to generate random elements and save then in MongoDB (users, URL's ...) *  @author José Manuel Ciges Regueiro <jmanuel@ciges.net>, Web page {@link http://www.ciges.net} *  @license http://www.gnu.org/copyleft/gpl.html GNU GPLv3 *  @version 20120718 * *  @package InternetAccessLog *  @filesource */require_once("RandomElements.class.php"); /** *  This class is used to generate random elements (users, IP's and URL's) and save them into MongoDB *  With this elements created we can simulate non FTP and FTP log entries (in our demo the acces by FTP are stored in a separate collection) */ class MongoRandomElements extends RandomElements	{     /**#@+	 * Default names for random data collections     */	const RNDUSERSC_NAME = "Random_UsersList";	const RNDIPSC_NAME = "Random_IPsList";	const RNDDOMAINSC_NAME = "Random_DomainsList";    /**#@-*/        /**#@+     * Constants for default connection values     */    const DEFAULT_USER = "mongodb";    const DEFAULT_PASSWORD = "mongodb";    const DEFAULT_HOST = "localhost";    const DEFAULT_DB = "InternetAcessLog";	/**#@-*/        /**#@+     * User, password, host and database name for MongoDB connection     * @access private     * @var string     */	private $db_user;	private $db_password;	private $db_host;	private $db_database;    /**#@-*/        /**     * Connection to the database     * @access private     * @var Mongo     */    private $db_conn;        /**#@+     * Number of element of each created collection in MongoDB (for cache purposes)     * @access private     * @var string     */	private $rnd_users_number;	private $rnd_ips_number;	private $rnd_domains_number;    /**#@-*/        /**     *  Constructor. For creating an instance we need to pass all the parameters for the MongoDB database where the data will be stored (user, password, host & database name).     *  <ul>     *  <li>The default user and password will be mongodb     *  <li>The default host will be localhost     *  <li>The default database name will be InternetAccessLog     *  </ul>     * @param string $user     * @param string $password     * @param string $host     * @param string $database	*/	function __construct($user = self::DEFAULT_USER, $password = self::DEFAULT_PASSWORD, $host = self::DEFAULT_HOST, $database = self::DEFAULT_DB)	{				// Open a connection to MongoDB		try {			$this->db_conn = new Mongo("mongodb://".$user.":".$password."@".$host."/".$database);		}		catch (MongoConnectionException $e) {			die("Connection to random database in MongoDB not possible: (".$e->getCode().") ".$e->getMessage()."\n");		}				// Stores the number of elements of each stored random elements collection		$this->rnd_users_number =  $this->db_conn->$database->self::RNDUSERSC_NAME->count();		$this->rnd_ips_number = $this->db_conn->$database->self::RNDIPSC_NAME->count();		$this->rnd_domains_number = $this->db_conn->$database->self::RNDDOMAINSC_NAME->count();	}        /**     *  Destructor. Close the open connection to MongoDB database 	 */	function __destruct()	{		$this->db_conn->close();	}        /**     *  Save random users in MongoDB.       *  The parameter are the number of users to create and if we want an unique index to be created for the user name (default is TRUE)     *  Each document will have a autonumeric id (1, 2, 3 ....) and the user name	 *  @param integer $number     *  @param boolean $use_index     */	function createUsers($number, $use_index = TRUE)	{		$i = $this->rnd_users_number + 1;   // Autonumeric                $usercol = $this->db_conn->self::RNDUSERSC_NAME;        if ($use_index) {            $usercol->ensureIndex(array('user' => 1), array("unique" => true));	// Unique index for the 'user' field            }		while ($i <= $number)	{			$user = $this->getRandomUser();			if (!$usercol->findOne(array("user" => $user))) {				try {					$usercol->insert(array("_id" => $i, "user" => $user));				}				catch (MongoConnectionException $e) {					die("Save of User document in MongoDB not possible: (".$e->getCode().") ".$e->getMessage()."\n");				}				$i++;			}        $this->rnd_users_number		}	}	 }  ?>